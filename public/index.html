<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Estiim – T-Shirt Estimator</title>
<!-- Lucide CDN script re-added for SVG icons -->
<script src="https://cdn.jsdelivr.net/npm/lucide@latest"></script>
<link rel="stylesheet" href="css/categories.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;display=swap');
:root { --bg:#f3f4f6; --card:#fff; --border:#e5e7eb; --primary:#2ecc71; --primary-dark:#27ae60; --text:#111827; --overlay:rgba(0,0,0,0.4); --orange:#f97316; --orange-dark:#ea580c; --red:#ef4444; --green:#22c55e; --blue: #007bff; --blue-dark: #0056b3; --light-green: #e0ffe0; --dark-green: #008000;} /* Added new green colors */
/* Added scroll-padding-top to account for sticky header */
html, body { scroll-behavior: smooth; scroll-padding-top: 60px; /* Adjust this value if header height changes */ }
* { box-sizing:border-box; font-family:Inter,Arial,sans-serif; }
body { margin:0; background:var(--bg); color:var(--text); font-size:12px; }
header { background:var(--primary); color:#fff; padding:12px 24px; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:1001; /* Ensure header is above flyout */ }
header h1 { margin:0; font-size:22px; font-weight:600; cursor:pointer; }
/* Removed nav a styles */
section { display:none; padding:24px; }
section.active { display:block; }
.card { background:var(--card); padding:20px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,.05); margin-bottom:24px; }
h2 { margin:0 0 12px; font-size:18px; font-weight:600; }
button, input, select, textarea { font-size:14px; padding:8px 10px; border-radius:6px; border:1px solid var(--border); }
button { background:var(--primary); color:#fff; border:none; cursor:pointer; }
button:hover { background:var(--primary-dark); }
table { width:100%; border-collapse:collapse; margin-top:12px; }
th, td { border:1px solid var(--border); padding:8px; text-align:left; }

/* Resource list styling in estimation factor modal */
#ef-hours {
    max-height: 288px; /* Show 6 items before scrolling (6 x 48px) */
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 8px;
}

#ef-hours .flex {
    display: flex;
    align-items: center;
    padding: 6px 0;
    gap: 12px;
}

#ef-hours label {
    min-width: 200px !important;
    flex: 1;
    font-weight: 500;
}

#ef-hours input[type="number"] {
    width: 80px;
    text-align: right;
}

#ef-hours select {
    width: 60px;
}
th[data-sort="name"],
#init-table td:nth-child(3) { /* nth-child(3) targets the Name column's td */
    width: 25%; /* Adjust as needed */
}
th { background:#f9fafb; }
.flex { display:flex; gap:12px; flex-wrap:wrap; }
input[type=number] { width:90px; }
.modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:var(--overlay); display:none; align-items:center; justify-content:center; z-index:1000; }
.modal { 
    background:var(--card); 
    padding:24px; 
    border-radius:8px; 
    max-width: 1200px; /* Increased from 900px for wider modal */
    width: 95%; 
    position:relative; 
    box-shadow:0 4px 8px rgba(0,0,0,.1); 
    margin-top: 32px; /* More whitespace below header */
}
.modal h2 { margin-top:0; }
.modal .close { position:absolute; top:12px; right:16px; background:none; border:none; font-size:18px; cursor:pointer; color:var(--text); }
.modal pre { white-space:pre-wrap; background:#f3f4f6; padding:10px; border-radius:4px; max-height:300px; overflow-y:auto; }
.audit-container { max-height: 400px; overflow-y: auto; }
.audit-item { margin-bottom: 15px; padding: 10px; border: 1px solid var(--border); border-radius: 6px; }
.audit-item h4 { margin: 0 0 8px; font-size: 16px; }
.audit-trail-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
.audit-trail-table th, .audit-trail-table td { border: 1px solid var(--border); padding: 8px; text-align: left; font-size: 12px; }
.audit-trail-table th { background: var(--bg); font-weight: 600; }
.audit-trail-container { margin-top: 16px; }
.diff-added { color: var(--green); }
.diff-removed { color: var(--red); text-decoration: line-through; }
.export-button {
    background-color: #007bff; /* Blue color */
    color: white;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
}
.export-button:hover {
    background-color: #0056b3; /* Darker blue on hover */
}
.import-button {
    background-color: var(--orange); /* Orange color */
    color: white;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
}
.import-button:hover {
    background-color: var(--orange-dark); /* Darker orange on hover */
}
/* New style for duplicate button */
.dup-button {
    background-color: var(--blue);
    color: white;
}
.dup-button:hover {
    background-color: var(--blue-dark);
}
footer {
    position: fixed;
    bottom: 0;
    width: 100%;
    text-align: center;
    color: #aaa;
    padding: 5px;
    font-size: 12px;
}

/* Styles for dropdown options management in preferences */
.dropdown-options-section {
    margin-bottom: 24px;
}

.dropdown-options-section h4 {
    margin: 0 0 12px 0;
    font-size: 14px;
    color: var(--text);
}

.dropdown-options-controls {
    display: flex;
    flex-direction: column;
    gap: 0;
    min-width: 100px;
}

#status-options-list,
#type-options-list,
#priority-options-list {
    font-size: 14px;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 4px;
}

#status-options-list option,
#type-options-list option,
#priority-options-list option {
    padding: 8px;
    cursor: pointer;
}

#status-options-list option:hover,
#type-options-list option:hover,
#priority-options-list option:hover {
    background-color: var(--bg);
}

/* Card title styles */
.card h3 {
    margin: 0 0 16px 0;
    font-size: 16px;
    font-weight: 600;
    color: var(--text);
}

/* Removed absolute positioning from .factor-calc. It will now be a child of the modal content. */
/* Renamed .factor-calc to .factor-summary-box and applied blue styling */
.factor-summary-box {
    font-size: 12px;
    text-align: right;
    line-height: 1.5;
    background-color: #e6f7ff; /* Light blue background, similar to original .factor-calc */
    padding: 8px 12px;
    border-radius: 6px;
    display: flex; /* Make it horizontal */
    gap: 12px;
    align-items: center;
    color: #007bff; /* Blue text color */
}
.factor-summary-box > div {
    white-space: nowrap;
}

/* New container to hold both the green and blue calculation boxes */
.calculations-container {
    display: flex; /* Arrange children horizontally */
    gap: 12px; /* Space between the green and blue boxes */
    margin-bottom: 20px; /* Space between calculations and search input */
    flex-wrap: wrap; /* Allow wrapping on smaller screens */
}

/* New style for date calculation box (green) */
.initiative-date-calc {
    background-color: var(--light-green); /* Light green background */
    color: var(--dark-green); /* Dark green text */
    padding: 8px 12px;
    border-radius: 6px;
    font-weight: bold;
    flex-grow: 1; /* Allow it to grow and take space */
    text-align: left; /* Align text to the left */
}

/* Adjust factor-search-input margin-top to ensure it's below the new container */
#factor-search-input {
    width: 100%;
    margin-top: 12px; /* Ensure space below the calculations container */
    margin-bottom: 12px;
    padding: 8px 10px;
    border: 1px solid var(--border);
    border-radius: 6px;
}


/* New styles for factor items and custom checkboxes */
.factor-item {
    display: flex;
    align-items: center;
    gap: 10px; /* Space between checkbox/label and quantity */
    margin-bottom: 8px;
    padding: 5px 0;
    border: 1px solid var(--border); /* Added border for clarity */
    border-radius: 66px; /* Increased border-radius for more rounded corners */
    padding: 10px;
    background-color: var(--card);
    box-shadow: 0 1px 2px rgba(0,0,0,.03);
    flex-wrap: wrap; /* Allow content to wrap */
}

.factor-item-content {
    flex-grow: 1; /* Allows content to take available space */
    display: flex;
    flex-direction: column; /* Stack name and resources vertically */
}

.factor-name {
    font-weight: 600;
    color: var(--text);
    margin-bottom: 4px; /* Space between name and resources */
}

.factor-resources {
    font-size: 0.85em;
    color: #555;
}

/* Custom checkbox styling */
.custom-checkbox {
    display: flex;
    align-items: center;
    cursor: pointer;
    position: relative;
    padding-left: 25px; /* Space for the custom box */
    user-select: none;
    min-height: 18px; /* Ensure enough height for the label text */
    margin-right: 10px; /* Space between checkbox and factor content */
}

.custom-checkbox input[type="checkbox"] {
    position: absolute;
    opacity: 0; /* Hide default checkbox */
    cursor: pointer;
    height: 0;
    width: 0;
}

.checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 18px;
    width: 18px;
    background-color: #eee;
    border-radius: 4px;
    border: 1px solid var(--border);
    transition: background-color 0.2s, border-color 0.2s;
}

.custom-checkbox:hover input ~ .checkmark {
    background-color: #ccc;
}

.custom-checkbox input:checked ~ .checkmark {
    background-color: var(--primary);
    border-color: var(--primary);
}

.checkmark:after {
    content: "";
    position: absolute;
    display: none;
}

.custom-checkbox input:checked ~ .checkmark:after {
    left: 6px;
    top: 2px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}

/* Quantity input styling for better appearance */
.factor-item input[type="number"] {
    flex-shrink: 0; /* Prevent shrinking */
    width: 70px; /* Smaller width for quantity */
    transition: all 0.3s ease-in-out; /* Smooth transition for display */
    opacity: 1; /* Default visible */
    pointer-events: auto; /* Default interactive */
}

.factor-item input[type="number"][style*="display: none"] {
    opacity: 0;
    pointer-events: none;
    width: 0; /* Collapse width when hidden */
    padding-left: 0;
    padding-right: 0;
    border: none; /* Hide border when collapsed */
}

/* Table header sortable styles */
.sortable-th {
    cursor: pointer;
    position: relative;
    padding-right: 20px; /* Space for arrow */
}

.sortable-th .sort-arrow {
    position: absolute;
    right: 5px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.8em;
    color: #888;
}

/* Journal styles */
.journal-entry {
    padding: 8px;
    border-bottom: 1px dashed var(--border);
    font-size: 0.9em;
    color: #555;
}
.journal-entry:last-child {
    border-bottom: none;
}
.journal-entry .timestamp {
    font-weight: 600;
    color: #333;
    margin-bottom: 4px;
    display: block;
}
.journal-entry.audit {
    background-color: #f0f8ff; /* Light blue for audit entries */
    border-left: 3px solid var(--primary);
    padding-left: 5px;
}
.journal-entry.audit .audit-summary {
    font-style: italic;
    color: #666;
}


/* Modal layout for initiative */
.modal-content-flex {
    display: flex;
    gap: 24px; /* Space between columns */
    flex-wrap: wrap; /* Allows columns to wrap on smaller screens */
}

.initiative-details-left {
    flex: 2; /* Takes more space on larger screens */
    min-width: 300px; /* Minimum width before wrapping */
}

.initiative-journal-right {
    flex: 1; /* Takes less space, but grows */
    min-width: 250px; /* Minimum width before wrapping */
    display: flex; /* Flex container for its own content */
    flex-direction: column; /* Stack journal elements vertically */
}

/* New style for calculated shirt size */
.calculated-shirt-size {
    font-size: 1.2em; /* Slightly larger font */
    font-weight: bold; /* Bold text */
    margin-top: 16px; /* Space above */
    margin-bottom: 8px; /* Space below */
}

/* Adjustments for smaller screens */
@media (max-width: 768px) {
    .modal-content-flex {
        flex-direction: column; /* Stack columns vertically */
    }
    .initiative-details-left,
    .initiative-journal-right {
        min-width: unset; /* Remove min-width to allow full width */
        width: 100%;
    }
}

/* Custom Message Box Styles */
.message-box-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--overlay);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000; /* Higher than other modals */
    display: none; /* Hidden by default */
}

.message-box {
    background: var(--card);
    padding: 24px;
    border-radius: 8px;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 44px 8px rgba(0,0,0,.1);
    text-align: center;
}

.message-box h3 {
    margin-top: 0;
    font-size: 20px;
    color: var(--text);
}

.message-box p {
    margin-bottom: 20px;
    color: #555;
}

.message-box button {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
}

.message-box button:hover {
    background-color: var(--primary-dark);
}

.message-box.success h3 {
    color: var(--green);
}

.message-box.error h3 {
    color: var(--red);
}

/* Styles for scrollable factor picker and search */
#factor-picker-container {
    max-height: 300px; /* Cap at roughly 6 items + padding */
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 10px;
    background-color: #f9fafb;
    margin-top: 12px;
}

#factor-search-input {
    width: 100%;
    margin-bottom: 12px;
    padding: 8px 10px;
    border: 1px solid var(--border);
    border-radius: 6px;
}

/* Flyout menu styles */
.flyout-menu-container {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%; /* Occupy full height of the header */
    display: flex;
    align-items: center;
    padding-right: 24px; /* Match header padding */
}

.gear-icon {
    cursor: pointer;
    width: 28px; /* Slightly larger icon */
    height: 28px;
    color: #fff;
    transition: transform 0.3s ease-in-out; /* Re-added transition for SVG */
    transform-origin: center center; /* Ensure rotation around center */
}

.gear-icon:hover {
    transform: rotate(90deg); /* Re-added rotation for SVG */
}

.flyout-menu {
    position: fixed; /* Fixed position relative to viewport */
    top: 0;
    right: 0;
    width: 250px; /* Width of the flyout menu */
    height: 100%;
    background-color: var(--primary-dark); /* Darker background for distinction */
    box-shadow: -4px 0 8px rgba(0,0,0,0.2);
    transform: translateX(100%); /* Start off-screen to the right */
    transition: transform 0.3s ease-in-out;
    padding-top: 60px; /* Space for header */
    z-index: 1000; /* Below header, above content */
    display: flex;
    flex-direction: column;
}

.flyout-menu.active {
    transform: translateX(0); /* Slide into view */
}

.flyout-menu a {
    color: #fff;
    padding: 15px 24px;
    text-decoration: none;
    font-weight: 500;
    border-bottom: 1px solid rgba(255,255,255,0.1); /* Subtle separator */
    transition: background-color 0.2s;
}

.flyout-menu a:hover {
    background-color: rgba(0,0,0,0.1); /* Slight hover effect */
}

.flyout-menu .close-btn {
    position: absolute;
    top: 12px;
    right: 16px;
    font-size: 24px;
    color: #fff;
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
}

/* Styles for scrollable estimation factors table and its search */
#ef-table-container {
    max-height: 225px; /* 5 items * ~45px height per row */
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 10px;
    background-color: #f9fafb;
}

#ef-search-input {
    flex-grow: 1; /* Allow it to take available space */
    margin-right: 12px; /* Space between search and add button */
    padding: 8px 10px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 14px;
}

/* Styles for Initiatives table container */
#init-table-container {
    max-height: 360px; /* 8 items * ~45px height per row */
    overflow-y: auto;
    overflow-x: auto; /* Added for horizontal scrolling */
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 10px;
    background-color: #f9fafb;
}

/* Styles for Resource Types table container */
#rt-table-container {
    max-height: 225px; /* 5 items * ~45px height per row */
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 10px;
    background-color: #f9fafb;
}

/* Styles for search inputs on main pages */
.main-page-search-input {
    flex-grow: 1; /* Allow it to take available space */
    margin-right: 12px; /* Space between search and add button */
    padding: 8px 10px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 14px;
}

/* In modal-init section */
#init-desc, #init-scope, #init-out {
    min-height: 80px; /* More visible lines for description, in scope, out of scope */
}

.modal {
    max-width: 1200px;
    width: 95%;
    margin-top: 32px; /* More whitespace below header */
}

#init-priority-num {
    width: 48px; /* Smaller Pri # box for 3 digits */
}

#init-custom-id {
    width: 120px; /* Smaller User-Defined ID box for 10 chars */
}
</style>
</head>
<body>
<header id="main-header">
  <h1 onclick="window.show('#home')">Estiim</h1>
  <div class="flyout-menu-container">
    <!-- Double Gear Icon SVG from provided code -->
    <svg class="gear-icon" onclick="window.toggleFlyoutMenu()" height="28px" width="28px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
	 viewBox="0 0 512 512" xml:space="preserve">
        <style type="text/css">
            .st0{fill:#FFFFFF;} /* Changed fill to white */
        </style>
        <g>
            <path class="st0" d="M336.896,269.874c-18.795,0-36.449,7.308-49.698,20.575c-13.276,13.267-20.593,30.912-20.593,49.698
                c0,18.768,7.307,36.422,20.593,49.707c13.276,13.267,30.921,20.574,49.698,20.574c18.769,0,36.422-7.307,49.698-20.574
                c13.276-13.286,20.584-30.939,20.584-49.707c0-18.778-7.307-36.43-20.574-49.689C373.336,277.182,355.682,269.874,336.896,269.874z
                M378.1,381.35c-11.011,11.003-25.636,17.061-41.204,17.061c-15.559,0-30.202-6.058-41.204-17.061
                c-11.011-11.002-17.07-25.635-17.07-41.203c0-15.568,6.058-30.202,17.07-41.195c11.002-11.011,25.645-17.069,41.204-17.069
                c15.568,0,30.193,6.058,41.204,17.069c11.002,10.993,17.06,25.627,17.06,41.195C395.161,355.715,389.102,370.348,378.1,381.35z"/>
            <path class="st0" d="M499.041,317.118l-37.455-5.428c-2.346-0.18-4.368-1.654-5.277-3.838l-12.134-29.294
                c-0.908-2.175-0.531-4.656,1.006-6.436l22.4-30.103c3.569-4.18,3.335-10.392-0.556-14.274l-17.726-17.726
                c-2.04-2.05-4.736-3.083-7.433-3.083c-2.427,0-4.863,0.836-6.832,2.526l-30.112,22.409c-1.141,0.98-2.588,1.492-4.044,1.492
                c-0.809,0-1.618-0.162-2.382-0.476l-29.312-12.153c-2.166-0.89-3.65-2.94-3.838-5.268l-5.438-37.455
                c-0.422-5.484-4.989-9.708-10.472-9.708h-25.078c-5.492,0-10.059,4.224-10.481,9.708l-5.447,37.455
                c-0.179,2.328-1.654,4.378-3.829,5.276l-29.312,12.144c-0.773,0.314-1.582,0.476-2.39,0.476c-1.456,0-2.895-0.512-4.045-1.492
                l-30.094-22.4c-1.969-1.69-4.404-2.535-6.822-2.535c-2.706,0-5.402,1.043-7.452,3.092l-17.726,17.717
                c-3.883,3.892-4.116,10.094-0.557,14.274l22.4,30.103c1.519,1.779,1.914,4.26,1.016,6.436l-12.144,29.303
                c-0.881,2.175-2.931,3.65-5.258,3.829l-37.474,5.438c-5.464,0.432-9.689,4.998-9.689,10.49v25.06
                c0,5.502,4.225,10.068,9.689,10.498l37.474,5.43c2.328,0.189,4.378,1.672,5.258,3.838l12.144,29.311
                c0.907,2.158,0.503,4.656-1.016,6.436l-22.4,30.103c-3.559,4.161-3.326,10.382,0.557,14.265l17.726,17.726
                c2.05,2.049,4.746,3.082,7.443,3.082c2.427,0,4.863-0.836,6.832-2.526l30.094-22.409c1.15-0.98,2.589-1.483,4.045-1.483
                c0.809,0,1.617,0.152,2.39,0.476L304.6,459.57c2.175,0.899,3.659,2.93,3.838,5.276l5.438,37.456
                c0.422,5.464,4.989,9.698,10.481,9.698h25.078c5.492,0,10.049-4.234,10.481-9.698l5.429-37.456
                c0.189-2.345,1.672-4.376,3.838-5.276l29.312-12.144c0.773-0.324,1.581-0.476,2.39-0.476c1.456,0,2.904,0.503,4.045,1.483
                l30.103,22.409c1.969,1.69,4.404,2.526,6.832,2.526c2.697,0,5.393-1.034,7.433-3.082l17.726-17.726
                c3.9-3.883,4.125-10.104,0.556-14.265l-22.4-30.103c-1.509-1.78-1.914-4.279-1.006-6.436l12.134-29.311
                c0.909-2.167,2.931-3.65,5.277-3.838l37.455-5.43c5.474-0.431,9.699-4.997,9.699-10.48v-25.078
                C508.74,322.125,504.515,317.559,499.041,317.118z M496.722,351.364l-36.574,5.304c-6.643,0.71-12.324,4.944-14.939,11.182
                l-12.126,29.266c-2.598,6.22-1.582,13.25,2.633,18.481l21.879,29.402l-15.856,15.855l-29.392-21.878
                c-3.236-2.616-7.29-4.054-11.461-4.054c-2.436,0-4.808,0.485-6.984,1.402l-29.339,12.152c-6.211,2.589-10.444,8.278-11.155,14.93
                l-5.302,36.574h-22.418l-5.312-36.565c-0.701-6.652-4.926-12.35-11.173-14.957l-29.276-12.117c-2.238-0.944-4.602-1.42-7.028-1.42
                c-4.153,0-8.198,1.438-11.443,4.044l-29.411,21.887l-15.847-15.855l21.87-29.402c4.224-5.232,5.24-12.27,2.652-18.446
                l-12.117-29.248c-2.553-6.256-8.252-10.517-14.94-11.236l-36.592-5.304v-22.436l36.575-5.303
                c6.714-0.701,12.422-4.98,14.929-11.164l12.126-29.267c2.606-6.22,1.591-13.258-2.633-18.48l-21.879-29.411l15.865-15.856
                l29.383,21.878c3.245,2.624,7.29,4.054,11.461,4.054c2.409,0,4.763-0.468,6.992-1.393l29.303-12.144
                c6.23-2.571,10.481-8.278,11.173-14.948l5.321-36.566h22.418l5.302,36.584c0.72,6.669,4.972,12.369,11.173,14.921l29.312,12.153
                c2.22,0.916,4.575,1.393,6.984,1.393c4.18,0,8.234-1.438,11.47-4.054l29.392-21.878l15.856,15.856l-21.86,29.375
                c-4.243,5.214-5.268,12.26-2.661,18.471l12.135,29.312c2.588,6.22,8.288,10.462,14.948,11.164l36.565,5.303V351.364z"/>
            <path class="st0" d="M186.04,154.802c6.499-13.987,7.173-29.663,1.888-44.135c-5.294-14.48-15.891-26.04-29.842-32.521
                c-7.792-3.64-16.062-5.465-24.575-5.429c-6.651,0.027-13.231,1.213-19.559,3.524c-14.498,5.285-26.057,15.883-32.556,29.86
                c-6.499,13.96-7.173,29.626-1.897,44.134c5.304,14.49,15.911,26.049,29.861,32.53c7.784,3.622,16.053,5.455,24.565,5.42
                c6.661-0.036,13.241-1.222,19.578-3.524C167.965,179.377,179.515,168.77,186.04,154.802z M149.376,173.372
                c-5.042,1.843-10.282,2.769-15.505,2.787c-6.634,0.036-13.25-1.403-19.442-4.288c-11.065-5.151-19.442-14.302-23.64-25.762
                c-4.17-11.478-3.65-23.882,1.501-34.939c5.151-11.074,14.31-19.469,25.77-23.639c5.051-1.852,10.292-2.778,15.506-2.796
                c6.634-0.028,13.24,1.411,19.433,4.297c11.056,5.15,19.451,14.301,23.64,25.761c4.18,11.47,3.648,23.865-1.493,34.939
                C169.978,160.797,160.837,169.184,149.376,173.372z"/>
        </g>
    </svg>
  </div>
</header>

<!-- Flyout Menu -->
<div id="flyout-menu" class="flyout-menu">
    <button class="close-btn" onclick="window.toggleFlyoutMenu()">×</button>
    <a href="#home" onclick="window.show('#home')">Home</a>
    <a href="#factors" onclick="window.show('#factors')">Estimation Factors</a>
    <a href="#shirt-sizes" onclick="window.show('#shirt-sizes')">Shirt Sizes</a>
    <a href="#backups" onclick="window.show('#backups')">Backups</a>
    <a href="#prefs" onclick="window.show('#prefs')">Prefs</a>
</div>

<section id="home" class="active">
  <div class="card flex" style="justify-content:space-between;align-items:center;">
    <div class="flex" style="align-items:baseline;gap:16px;">
        <h2>Initiatives</h2>
        <span id="init-count" style="color:#666;">0 initiatives shown</span>
    </div>
    <div class="flex">
        <!-- New search input for the main initiatives page -->
        <input type="text" id="init-search-input" class="main-page-search-input" placeholder="Search initiatives..." oninput="window.loadInitiatives(currentSortColumn, currentSortDirection)">
        <select id="init-status-filter" onchange="window.loadInitiatives(currentSortColumn, currentSortDirection)">
            <option value="">All Statuses</option>
        </select>
        <button onclick="window.addInitiative()">+ Add Initiative</button>
        <button class="export-button" onclick="window.exportInitiatives()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg> Export
        </button>
        <button class="export-button" onclick="window.exportResourceView()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg> Export Resource View
        </button>
        <button class="import-button" onclick="window.importInitiatives()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-upload"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg> Import
        </button>
        <input type="file" id="importFileInput" accept=".tsv" style="display: none;" onchange="window.handleImportFile(event)">
    </div>
  </div>
  <div id="init-table-container" class="card">
    <table id="init-table">
        <thead>
            <tr>
                <th class="sortable-th" data-sort="id">Internal ID<span class="sort-arrow"></span></th>
                <th class="sortable-th" data-sort="custom_id">User-Defined ID<span class="sort-arrow"></span></th>
                <th class="sortable-th" data-sort="name">Name<span class="sort-arrow"></span></th>
                <th class="sortable-th" data-sort="priority">Priority<span class="sort-arrow"></span></th>
                <th class="sortable-th" data-sort="estimation_type">Estimation Type<span class="sort-arrow"></span></th>
                <th class="sortable-th" data-sort="status">Status<span class="sort-arrow"></span></th>
                <th class="sortable-th" data-sort="shirt_size">Shirt Size<span class="sort-arrow"></span></th>
                <th class="sortable-th" data-sort="computed_hours">Estimated Hours<span class="sort-arrow"></span></th>
                <th class="sortable-th" data-sort="estimated_duration">Est. Duration (mo)<span class="sort-arrow"></span></th>
                <th>Categories</th>
                <th class="sortable-th" data-sort="created_at">Created<span class="sort-arrow"></span></th>
                <th class="sortable-th" data-sort="updated_at">Updated<span class="sort-arrow"></span></th>
                <th></th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
  </div>
</section>

<section id="factors">
  <div class="card">
    <div class="flex" style="justify-content:space-between;align-items:center;">
        <h2>Resource Types</h2>
        <!-- New search input for the main resource types page -->
        <input type="text" id="rt-search-input" class="main-page-search-input" placeholder="Search resource types..." oninput="window.loadRT()">
        <button onclick="window.openAddResourceTypeModal()">+ Add Resource Type</button>
    </div>
    <div id="rt-table-container" class="card">
        <table id="rt-table"><thead><tr><th>Name</th><th>Description</th><th>Resource Type</th><th>Resource Cost</th><th></th></tr></thead><tbody></tbody></table>
    </div>
  </div>

  <div class="card" style="margin-top: 24px;">
    <div class="flex" style="justify-content:space-between;align-items:center; margin-bottom: 12px;">
        <h2>Estimation Factors</h2>
        <!-- Existing search input for the main factors page -->
        <input type="text" id="ef-search-input" class="main-page-search-input" placeholder="Search factors..." oninput="window.loadEF()">
        <button onclick="window.addEstimationFactor()">+ Add Estimation Factor</button>
    </div>
    <!-- Existing container for scrollable estimation factors table -->
    <div id="ef-table-container" class="card">
        <table id="ef-table"><thead><tr><th>Name</th><th>Resources</th><th>Days</th><th>Hours</th><th></th></tr></thead><tbody></tbody></table>
    </div>
  </div>
</section>

<section id="shirt-sizes">
    <div class="card flex" style="justify-content:space-between;align-items:center;">
        <h2>Shirt Size Configuration</h2>
        <div><button onclick="window.saveShirtSizes()">Save</button><button onclick="window.loadShirtSizes()" style="background:var(--border);color:var(--text)">Cancel</button><button onclick="window.showShirtSizeAuditTrail()" style="margin-left:8px;">🔍 Audit</button></div>
    </div>
    <div class="card">
        <p>Set the minimum estimated hours for each T-shirt size.</p>
        <table id="shirt-size-table"><thead><tr><th>Size</th><th>Hours</th><th>Days</th><th>Months</th></tr></thead><tbody></tbody></table>
    </div>
</section>

<!-- New Prefs Section -->
<section id="prefs">
    <div class="card flex" style="justify-content:space-between;align-items:center;">
        <h2>Preferences</h2>
    </div>
    
    <div id="preferences-content">
        <!-- Dropdown Options Management -->
        <div class="card">
            <h3>Dropdown Options</h3>
            <p>Manage options for initiative dropdowns:</p>
            
            <!-- Status Options -->
            <div class="dropdown-options-section">
                <h4>Status Options</h4>
                <div class="flex" style="margin-bottom: 12px;">
                    <select id="status-options-list" size="6" style="flex: 1; min-height: 150px;"></select>
                    <div class="dropdown-options-controls">
                        <button onclick="window.addDropdownOption('status')" style="width: 100%; margin-bottom: 8px;">Add</button>
                        <button onclick="window.editDropdownOption('status')" style="width: 100%; margin-bottom: 8px; background: var(--blue);">Edit</button>
                        <button onclick="window.removeDropdownOption('status')" style="width: 100%; background: var(--red);">Remove</button>
                    </div>
                </div>
            </div>
            
            <!-- Type Options -->
            <div class="dropdown-options-section">
                <h4>Estimation Type Options</h4>
                <div class="flex" style="margin-bottom: 12px;">
                    <select id="type-options-list" size="6" style="flex: 1; min-height: 150px;"></select>
                    <div class="dropdown-options-controls">
                        <button onclick="window.addDropdownOption('type')" style="width: 100%; margin-bottom: 8px;">Add</button>
                        <button onclick="window.editDropdownOption('type')" style="width: 100%; margin-bottom: 8px; background: var(--blue);">Edit</button>
                        <button onclick="window.removeDropdownOption('type')" style="width: 100%; background: var(--red);">Remove</button>
                    </div>
                </div>
            </div>
            
            <!-- Priority Options -->
            <div class="dropdown-options-section">
                <h4>Priority Options</h4>
                <div class="flex" style="margin-bottom: 12px;">
                    <select id="priority-options-list" size="6" style="flex: 1; min-height: 150px;"></select>
                    <div class="dropdown-options-controls">
                        <button onclick="window.addDropdownOption('priority')" style="width: 100%; margin-bottom: 8px;">Add</button>
                        <button onclick="window.editDropdownOption('priority')" style="width: 100%; margin-bottom: 8px; background: var(--blue);">Edit</button>
                        <button onclick="window.removeDropdownOption('priority')" style="width: 100%; background: var(--red);">Remove</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Categories Management -->
        <div class="card">
            <h3>Categories</h3>
            <div class="pref-content">
                <div class="pref-row" style="margin-bottom: 12px;">
                    <input type="text" id="new-category" placeholder="New category name">
                    <button onclick="window.addCategory()">Add</button>
                </div>
                <div id="categories-list" class="list-container"></div>
            </div>
        </div>

        <!-- General Preferences -->
        <div class="card" id="prefs-card">
            <h3>General Preferences</h3>
            <label style="display:block;margin-top:16px;">
                <input type="checkbox" id="branding-checkbox"> Enable logos and branding
            </label>
        </div>
        <div style="text-align:right;margin:32px 0 0 0;">
            <button onclick="window.savePreferences()">Save</button>
            <button onclick="window.populatePrefsPage()" style="background:var(--border);color:var(--text)">Cancel</button>
        </div>
    </div>
</section>

<section id="backups">
  <div class="card">
    <h2>Database Backup Settings</h2>
    <div class="card">
      <h3>Automatic Backup Frequency</h3>
      <p>Current frequency: <span id="currentFrequency">loading...</span></p>
      <div class="flex" style="margin-top: 12px;">
        <input type="number" id="backupFrequency" min="5" max="1440" step="5" placeholder="Minutes between backups">
        <button id="updateFrequency">Update Frequency</button>
      </div>
      <p class="help-text">Frequency must be between 5 and 1440 minutes (24 hours)</p>
    </div>

    <div class="card" style="margin-top: 20px;">
      <div class="flex" style="justify-content: space-between; align-items: center;">
        <h3>Available Backups</h3>
        <button id="createBackup">Create Backup Now</button>
      </div>
      <div class="table-container" style="margin-top: 12px;">
        <table class="backup-table">
          <thead>
            <tr>
              <th>Backup File</th>
              <th>Created</th>
              <th>Size</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="backupsList">
            <tr>
              <td colspan="4">Loading backups...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<!-- Modals -->
<div id="modal-init" class="modal-overlay"><div class="modal">
    <button class="close" onclick="window.closeModal('init')">×</button>
    <h2>Add / Edit Initiative</h2>
    <input id="init-id" type="hidden">
    
    <div class="modal-content-flex">
        <div class="initiative-details-left">
            <div class="flex">
                <input id="init-name" placeholder="Name" style="flex:1">
                <input id="init-custom-id" placeholder="User-Defined ID" maxlength="10" style="width:120px">
            </div>
            <textarea id="init-desc" placeholder="Description" style="width:100%;margin-top:12px;min-height:80px"></textarea>
            <div class="flex" style="margin-top:12px">
                <div>
                    <label>Priority</label><br>
                    <select id="init-priority"></select>
                </div>
                <div>
                    <label>Pri #</label><br>
                    <input id="init-priority-num" type="number" min="1" max="999" style="width:48px">
                </div>
                <div>
                    <label>Status</label><br>
                    <select id="init-status"></select>
                </div>
                <div>
                    <label>Estimation Type</label><br>
                    <select id="init-estimation-type"></select>
                </div>
                <div style="margin-left:24px">
                    <label>Start Date</label><br>
                    <input id="init-start-date" type="date" style="width:130px">
                </div>
                <div>
                    <label>End Date</label><br>
                    <input id="init-end-date" type="date" style="width:130px">
                </div>
                <div>
                    <label>Estimated Duration (months)</label><br>
                    <input id="init-estimated-duration" type="number" min="1" max="99" style="width:80px">
                </div>
                <div style="flex: 1;">
                    <label>Categories</label><br>
                    <div style="display: flex; gap: 8px; align-items: flex-start;">
                        <div class="category-input-container" style="min-width: 150px;">
                            <input id="init-categories" type="text" placeholder="Add category" style="width:100%">
                            <div id="category-suggestions" class="category-suggestions" style="display:none"></div>
                        </div>
                        <div id="categories-display" class="categories-display" style="flex: 1; margin: 0;"></div>
                    </div>
                </div>
            </div>
            <div class="flex" style="margin-top:12px">
                <textarea id="init-scope" placeholder="In Scope" style="flex:1;min-height:80px;margin-right:8px"></textarea>
                <textarea id="init-out" placeholder="Out of Scope" style="flex:1;min-height:80px"></textarea>
            </div>
            
            <!-- Calculated T-Shirt Size moved here -->
            <div class="calculated-shirt-size" id="init-calculated-shirt-size"></div>

            <div style="margin-top:16px">
                <h3>T-Shirt Factors</h3>
                <div id="selected-factors-summary"></div>
                <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
                    <button style="flex:1" onclick="window.openFactorModal()">Select Factors</button>
                </div>
            </div>
        </div>

        <!-- Journal Section -->
        <div class="initiative-journal-right">
            <div class="flex" style="margin-bottom:12px;">
                <div style="flex:1;"><label><b>Created</b></label><br><span id="init-created"></span></div>
                <div style="flex:1;"><label><b>Updated</b></label><br><span id="init-updated"></span></div>
            </div>
            <h3>Journal</h3>
            <div id="initiative-journal-log" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border); padding: 10px; border-radius: 6px; background: #f9fafb; flex-grow: 1;"></div>
            <textarea id="journal-comment-input" placeholder="Add a new comment..." style="width:100%; margin-top:10px; min-height: 60px;"></textarea>
            <button onclick="window.addJournalComment()" style="margin-top:8px;">Add Comment</button>
        </div>
    </div>

    <div class="flex" style="justify-content:flex-end;margin-top:16px">
        <button class="dup-button" onclick="window.duplicateInitiative()">Dup</button> <!-- New Dup button -->
        <button onclick="window.saveInitiative()">Save</button>
        <button onclick="window.closeModal('init')" style="background:var(--border);color:var(--text)">Cancel</button>
    </div>
</div></div>

<div id="modal-rt" class="modal-overlay"><div class="modal">
    <button class="close" onclick="window.closeModal('rt')">×</button>
    <h2>Add / Edit Resource Type</h2>
    <input id="rt-id" type="hidden">
    <input id="rt-name" placeholder="Name" style="width:100%;margin-top:12px">
    <textarea id="rt-desc" placeholder="Description" style="width:100%;margin-top:12px"></textarea>
    
    <div style="display: flex; gap: 12px; margin-top: 12px;">
        <div style="flex: 1;">
            <label for="rt-category" style="display: block; margin-bottom: 4px; font-weight: 600;">Resource Type</label>
            <select id="rt-category" style="width:100%;">
                <option value="Labour">Labour</option>
                <option value="Non-Labour">Non-Labour</option>
            </select>
        </div>
        <div style="flex: 1;">
            <label for="rt-cost" style="display: block; margin-bottom: 4px; font-weight: 600;">Resource Cost</label>
            <input id="rt-cost" type="number" step="0.01" min="0" placeholder="0.00" style="width:100%;" />
        </div>
    </div>
    
    <div style="text-align:right;margin-top:16px"><button onclick="window.saveResourceType()">Save</button><button onclick="window.closeModal('rt')" style="background:var(--border);color:var(--text)">Cancel</button></div>
</div></div>

<div id="modal-ef" class="modal-overlay"><div class="modal">
    <button class="close" onclick="window.closeModal('ef')">×</button>
    <h2>Add / Edit Estimation Factor</h2>
    <input id="ef-id" type="hidden">
    
    <div class="modal-content-flex">
        <div class="initiative-details-left"> <!-- Reusing class for layout -->
            <input id="ef-name" placeholder="Name" style="width:100%;margin-top:12px">
            <textarea id="ef-description" placeholder="Description" style="width:100%;margin-top:12px"></textarea> <!-- New description field -->
            <div id="ef-hours" style="margin-top:12px"></div>
        </div>
        <div class="initiative-journal-right"> <!-- Reusing class for layout -->
            <div class="flex" style="margin-bottom:12px;">
                <div style="flex:1;"><label><b>Created</b></label><br><span id="ef-created"></span></div>
                <div style="flex:1;"><label><b>Updated</b></label><br><span id="ef-updated"></span></div>
            </div>
            <h3>Journal</h3>
            <div id="ef-journal-log" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border); padding: 10px; border-radius: 6px; background: #f9fafb; flex-grow: 1;"></div>
            <textarea id="ef-journal-comment-input" placeholder="Add a new comment..." style="width:100%; margin-top:10px; min-height: 60px;"></textarea>
            <button onclick="window.addJournalCommentEF()" style="margin-top:8px;">Add Comment</button>
        </div>
    </div>

    <div class="flex" style="justify-content:flex-end;margin-top:16px">
        <button class="dup-button" onclick="window.duplicateEstimationFactor()">Dup</button> <!-- New Dup button -->
        <button onclick="window.saveEstimationFactor()">Save</button>
        <button onclick="window.closeModal('ef')" style="background:var(--border);color:var(--text)">Cancel</button>
    </div>
</div></div>

<div id="modal-factors" class="modal-overlay"><div class="modal">
    <button class="close" onclick="window.closeModal('factors')">×</button>
    <h2 style="padding-right: 120px;">T-Shirt Factors</h2>
    <!-- New container for both date and factor calculations -->
    <div class="calculations-container">
      <!-- New div for date calculations (green box) -->
      <div id="initiative-date-calc" class="initiative-date-calc">
        Start: N/A | End: N/A | Duration: Check
      </div>
      <!-- Wrapper for existing factor calculation elements (blue box) -->
      <div class="factor-summary-box">
        <div id="factor-hours">0h</div>
        <div id="factor-days">0d</div>
        <div id="factor-months">0m</div>
        <div id="factor-size">Size: XS</div>
      </div>
    </div>

    <!-- New search input -->
    <input type="text" id="factor-search-input" placeholder="Search factors..." oninput="window.loadFactorPicker(this.value)">
    <div id="factor-picker-container"> <!-- New container for scrollbar -->
        <div id="factor-picker"></div>
    </div>
    <div style="text-align:right;margin-top:16px"><button onclick="window.saveFactors()">Save</button><button onclick="window.closeModal('factors')" style="background:var(--border);color:var(--text)">Cancel</button></div>
</div></div>

<div id="modal-audit" class="modal-overlay"><div class="modal">
    <button class="close" onclick="window.closeModal('audit')">×</button>
    <h2 id="audit-title">Audit Trail</h2>
    <div id="audit-content" class="audit-container"></div>
</div></div>

<div id="modal-shirt-size-audit" class="modal-overlay"><div class="modal">
    <button class="close" onclick="window.closeModal('shirt-size-audit')">×</button>
    <h2 id="shirt-size-audit-title">Shirt Size Audit Trail</h2>
    <div id="shirt-size-audit-content" class="audit-container"></div>
</div></div>

<!-- New modal for Estimation Factor Audit -->
<div id="modal-ef-audit" class="message-box-overlay"> <!-- Reusing overlay class for simplicity -->
    <div class="modal">
        <button class="close" onclick="window.closeModal('ef-audit')">×</button>
        <h2 id="ef-audit-title">Estimation Factor Audit Trail</h2>
        <div id="ef-audit-content" class="audit-container"></div>
    </div>
</div>


<!-- Tooltip for initiative name -->
<div id="init-name-tooltip"></div>

<!-- Custom Message Box Modal -->
<div id="messageBoxModal" class="message-box-overlay">
    <div class="message-box">
        <h3 id="messageBoxTitle"></h3>
        <p id="messageBoxContent"></p>
        <button onclick="window.hideMessage()">OK</button>
    </div>
</div>

<footer>
    Build R20250804161100
</footer>

<!-- Refactored script includes -->
<script type="module" src="js/app.js"></script>
<script type="module" src="js/backup.js"></script>

</body>
</html>
